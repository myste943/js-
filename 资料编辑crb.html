<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蜡笔小新粉丝站 - 编辑资料</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FFD700', // 金色主色调
                        secondary: '#FF6B6B', // 粉色辅助色
                        dark: '#2D3748', // 深色背景
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities { .content-auto { content-visibility: auto; } .text-shadow { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); } .bg-blur { backdrop-filter: blur(8px); } .form-input-focus { @apply focus:border-primary focus:ring focus:ring-primary/30 focus:outline-none
        transition-all duration-200; } .form-input-error { @apply border-red-500 focus:border-red-500 focus:ring-red-200; } .pulse-animation { animation: pulse 2s infinite; } @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity:
        1; } } }
    </style>
</head>

<body class="bg-gray-900 text-white min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <nav class="bg-dark/80 bg-blur border-b border-gray-700 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="https://picsum.photos/40/40" alt="蜡笔小新logo" class="w-10 h-10 rounded-full">
                <span class="text-primary font-bold text-xl">蜡笔小新粉丝站</span>
            </div>
            <div class="hidden md:flex items-center space-x-6">
                <a href="首页crb.html" class="hover:text-yellow transition-colors duration-200">
                    <i class="fa fa-home mr-1"></i>首页
                </a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-white focus:outline-none">
                    <i class="fa fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        <!-- 移动端菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-dark/95 bg-blur border-b border-gray-700">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="首页crb.html" class="py-2 hover:text-yellow transition-colors duration-200">首页</a>
                <a href="资料编辑.html" class="py-2 hover:text-yellow transition-colors duration-200 text-primary font-medium">编辑资料</a>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- 返回按钮 -->
            <div class="mb-6">
                <a href="用户详情页crb.html" class="inline-flex items-center text-gray-400 hover:text-primary transition-colors duration-200">
                    <i class="fa fa-arrow-left mr-2"></i> 返回个人主页
                </a>
            </div>

            <!-- 编辑资料表单 -->
            <div class="bg-gray-800/50 rounded-xl p-6 shadow-lg border border-gray-700">
                <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-center mb-8 text-primary">编辑个人资料</h1>

                <form id="edit-profile-form" class="space-y-6">
                    <!-- 用户名 -->
                    <div class="space-y-2">
                        <label for="username" class="block text-sm font-medium text-gray-300">用户名</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-user text-gray-400"></i>
                            </div>
                            <input type="text" id="username" name="username" class="pl-10 block w-full rounded-md border-gray-700 bg-gray-900/50 py-2 px-4 text-white form-input-focus" placeholder="请输入用户名">
                            <p class="hidden text-red-400 text-xs mt-1" id="username-error">用户名不能为空</p>
                        </div>
                    </div>

                    <!-- 头像 -->
                    <div class="space-y-4">
                        <label class="block text-sm font-medium text-gray-300">头像</label>
                        <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
                            <div class="w-32 h-32 rounded-full overflow-hidden border-4 border-primary">
                                <img id="avatar-preview" src="https://picsum.photos/200/200" alt="用户头像" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <button type="button" id="change-avatar-btn" class="bg-primary/20 hover:bg-primary/30 text-primary px-4 py-2 rounded-lg transition-colors duration-200 inline-flex items-center">
                                    <i class="fa fa-camera mr-1"></i> 更换头像
                                </button>
                                <p class="text-gray-400 text-xs mt-2">点击上方按钮随机更换头像（实际项目中应实现上传功能）</p>
                            </div>
                        </div>
                    </div>

                    <!-- 积分 -->
                    <div class="space-y-2">
                        <label for="points" class="block text-sm font-medium text-gray-300">积分</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-diamond text-gray-400"></i>
                            </div>
                            <input type="number" id="points" name="points" class="pl-10 block w-full rounded-md border-gray-700 bg-gray-900/50 py-2 px-4 text-white form-input-focus" placeholder="请输入积分">
                            <p class="hidden text-red-400 text-xs mt-1" id="points-error">积分必须为数字</p>
                        </div>
                    </div>

                    <!-- 个人简介 -->
                    <div class="space-y-2">
                        <label for="bio" class="block text-sm font-medium text-gray-300">个人简介</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-file-text-o text-gray-400"></i>
                            </div>
                            <textarea id="bio" name="bio" rows="4" class="pl-10 block w-full rounded-md border-gray-700 bg-gray-900/50 py-2 px-4 text-white form-input-focus" placeholder="请输入个人简介（不超过200字）"></textarea>
                            <div class="flex justify-between items-center mt-1">
                                <p class="text-gray-400 text-xs">个人简介有助于其他粉丝了解你</p>
                                <span class="text-gray-500 text-xs" id="bio-length">0/200</span>
                            </div>
                        </div>
                    </div>

                    <!-- 联系方式 -->
                    <div class="space-y-2">
                        <label for="contact" class="block text-sm font-medium text-gray-300">联系方式</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fa fa-envelope-o text-gray-400"></i>
                            </div>
                            <input type="text" id="contact" name="contact" class="pl-10 block w-full rounded-md border-gray-700 bg-gray-900/50 py-2 px-4 text-white form-input-focus" placeholder="请输入联系方式（邮箱或手机号）">
                            <p class="hidden text-red-400 text-xs mt-1" id="contact-error">请输入有效的联系方式</p>
                        </div>
                    </div>

                    <!-- 提交按钮 -->
                    <div class="pt-4">
                        <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-dark font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-primary/50">
                            <i class="fa fa-save mr-2"></i>保存修改
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark border-t border-gray-800 py-6">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-gray-400 text-sm">&copy; 2025 蜡笔小新粉丝站. 保留所有权利.</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-primary transition-colors duration-200">
                        <i class="fa fa-weibo"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-primary transition-colors duration-200">
                        <i class="fa fa-wechat"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-primary transition-colors duration-200">
                        <i class="fa fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-primary transition-colors duration-200">
                        <i class="fa fa-twitter"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- 成功提示模态框 -->
    <div id="success-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 border border-gray-700 transform transition-all">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 text-green-500 mb-4">
                    <i class="fa fa-check text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">资料更新成功</h3>
                <p class="text-gray-400 mb-6" id="update-message">你的个人资料已成功更新！</p>
                <button id="close-modal" class="bg-primary hover:bg-primary/90 text-dark font-bold py-2 px-6 rounded-lg transition-colors duration-200">
                    返回个人主页
                </button>
            </div>
        </div>
    </div>

    <script>
        // 移动端菜单切换
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // 页面加载时从localStorage获取用户数据
        document.addEventListener('DOMContentLoaded', function() {
            // 获取当前用户名（如果没有则默认为蜡笔小新粉丝）
            const currentUser = localStorage.getItem('currentUser') || '蜡笔小新粉丝';
            // 获取用户数据
            const userData = localStorage.getItem(`user_${currentUser}`);

            if (userData) {
                const user = JSON.parse(userData);

                // 填充表单
                document.getElementById('username').value = user.username || '';
                document.getElementById('points').value = user.points || '';
                document.getElementById('bio').value = user.bio || '';
                document.getElementById('contact').value = user.contact || '';

                // 更新头像预览
                if (user.avatar) {
                    document.getElementById('avatar-preview').src = user.avatar;
                }
            }

            // 监听简介字数
            const bioInput = document.getElementById('bio');
            const bioLength = document.getElementById('bio-length');

            bioInput.addEventListener('input', function() {
                const length = this.value.length;
                bioLength.textContent = `${length}/200`;

                if (length > 200) {
                    this.value = this.value.substring(0, 200);
                    bioLength.textContent = '200/200';
                    bioLength.classList.add('text-red-400');
                } else {
                    bioLength.classList.remove('text-red-400');
                }
            });

            // 处理更换头像按钮点击事件
            document.getElementById('change-avatar-btn').addEventListener('click', function() {
                // 注意：实际项目中需要实现文件上传功能
                // 这里仅使用示例图片模拟
                const randomId = Math.floor(Math.random() * 1000);
                const newAvatar = `https://picsum.photos/200/200?random=${randomId}`;
                document.getElementById('avatar-preview').src = newAvatar;
            });

            // 用户名输入实时保存到localStorage
            const usernameInput = document.getElementById('username');
            usernameInput.addEventListener('input', function() {
                const username = this.value.trim();
                const currentUser = localStorage.getItem('currentUser') || '蜡笔小新粉丝';

                // 获取现有用户数据
                let userData = JSON.parse(localStorage.getItem(`user_${currentUser}`) || '{}');

                // 更新用户名
                userData.username = username;

                // 保存到localStorage
                localStorage.setItem(`user_${currentUser}`, JSON.stringify(userData));

                // 如果用户名更改了，同时更新currentUser
                if (username && username !== currentUser) {
                    localStorage.setItem('currentUser', username);

                    // 通知其他页面用户名已更改
                    window.dispatchEvent(new StorageEvent('storage', {
                        key: 'currentUser',
                        newValue: username
                    }));
                }

                // 触发storage事件，通知其他页面更新
                window.dispatchEvent(new StorageEvent('storage', {
                    key: `user_${currentUser}`,
                    newValue: JSON.stringify(userData)
                }));
            });

            // 表单验证
            const form = document.getElementById('edit-profile-form');
            form.addEventListener('submit', function(e) {
                e.preventDefault();

                let isValid = true;
                const username = document.getElementById('username').value.trim();
                const points = document.getElementById('points').value.trim();
                const contact = document.getElementById('contact').value.trim();

                // 重置所有错误提示
                document.querySelectorAll('.form-input-error').forEach(el => {
                    el.classList.remove('form-input-error');
                });
                document.querySelectorAll('[id$="-error"]').forEach(el => {
                    el.classList.add('hidden');
                });

                // 验证用户名
                if (!username) {
                    document.getElementById('username').classList.add('form-input-error');
                    document.getElementById('username-error').classList.remove('hidden');
                    isValid = false;
                }

                // 验证积分（如果填写）
                if (points && isNaN(parseInt(points))) {
                    document.getElementById('points').classList.add('form-input-error');
                    document.getElementById('points-error').classList.remove('hidden');
                    isValid = false;
                }

                // 验证联系方式（如果填写）
                if (contact && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(contact) && !/^1[3-9]\d{9}$/.test(contact)) {
                    document.getElementById('contact').classList.add('form-input-error');
                    document.getElementById('contact-error').classList.remove('hidden');
                    isValid = false;
                }

                if (!isValid) return;

                // 获取当前用户名
                const currentUser = localStorage.getItem('currentUser') || '蜡笔小新粉丝';

                // 获取现有用户数据
                let userData = localStorage.getItem(`user_${currentUser}`);
                userData = userData ? JSON.parse(userData) : {};

                // 获取表单数据并比较更新的字段
                const formData = {
                    username: document.getElementById('username').value,
                    points: document.getElementById('points').value,
                    bio: document.getElementById('bio').value,
                    contact: document.getElementById('contact').value,
                    avatar: document.getElementById('avatar-preview').src
                };

                const updatedFields = [];
                for (const key in formData) {
                    if (formData[key] !== undefined && formData[key] !== '' && formData[key] !== userData[key]) {
                        userData[key] = formData[key];
                        updatedFields.push(key);
                    }
                }

                // 保存更新后的数据到localStorage
                localStorage.setItem(`user_${currentUser}`, JSON.stringify(userData));

                // 显示成功提示，包含更新的字段
                const fieldNames = {
                    username: '用户名',
                    points: '积分',
                    bio: '个人简介',
                    contact: '联系方式',
                    avatar: '头像'
                };

                let message = '你的个人资料已成功更新';
                if (updatedFields.length > 0) {
                    message += `：${updatedFields.map(field => fieldNames[field]).join('、')}`;
                }
                document.getElementById('update-message').textContent = message;

                // 显示成功提示
                document.getElementById('success-modal').classList.remove('hidden');

                // 2秒后自动跳转回个人主页
                setTimeout(() => {
                    window.location.href = '用户详情页crb.html';
                }, 2000);
            });

            // 关闭模态框并返回个人主页
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('success-modal').classList.add('hidden');
                window.location.href = '用户详情页crb.html';
            });

            // 监听localStorage变化，实现多页面同步
            window.addEventListener('storage', function(e) {
                if (e.key && e.key.startsWith('user_')) {
                    // 获取当前用户名
                    const currentUser = localStorage.getItem('currentUser') || '蜡笔小新粉丝';

                    // 检查是否是当前用户的数据变化
                    if (e.key === `user_${currentUser}`) {
                        // 更新表单数据
                        const user = JSON.parse(e.newValue);

                        // 只更新未被用户主动编辑的字段
                        if (!document.getElementById('username').isDirty) {
                            document.getElementById('username').value = user.username || '';
                        }

                        if (!document.getElementById('points').isDirty) {
                            document.getElementById('points').value = user.points || '';
                        }

                        if (!document.getElementById('bio').isDirty) {
                            document.getElementById('bio').value = user.bio || '';
                        }

                        if (!document.getElementById('contact').isDirty) {
                            document.getElementById('contact').value = user.contact || '';
                        }

                        if (!document.getElementById('avatar-preview').isDirty) {
                            document.getElementById('avatar-preview').src = user.avatar || 'https://picsum.photos/200/200';
                        }
                    }
                }
            });

            // 标记字段是否被用户主动编辑
            document.querySelectorAll('input, textarea, img').forEach(el => {
                el.addEventListener('input', function() {
                    this.isDirty = true;
                });
            });
        });
    </script>
    <script>
        function saveUserInfo() {
            // 获取表单数据
            const username = document.getElementById('username').value;
            const avatar = document.getElementById('avatar').value;
            const birthday = document.getElementById('birthday').value;
            const location = document.getElementById('location').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;

            // 构建用户信息对象
            const userInfo = {
                username,
                avatar,
                birthday,
                location,
                email,
                phone,
                userId: 'CRB_' + Date.now().toString().slice(-8) // 生成唯一ID
            };

            // 保存到localStorage
            localStorage.setItem('userInfo', JSON.stringify(userInfo));

            // 通知当前页面更新（使用postMessage）
            window.opener.postMessage({
                type: 'userInfoUpdated',
                data: userInfo
            }, window.location.origin);

            // 显示成功消息并关闭窗口（或跳转）
            alert('资料更新成功！');
            window.close(); // 如果是弹窗
            // 或者 window.location.href = '用户详情页crb.html';
        }
    </script>
</body>

</html>